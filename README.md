# Next.js キャッシュデモ

このプロジェクトは、Next.js の App Router における異なるキャッシュ戦略の挙動を理解するためのデモンストレーションアプリケーションです。

## 概要

Next.js は、ウェブアプリケーションのパフォーマンスを最適化するために様々なキャッシュメカニズムを提供しています。このプロジェクトでは、主に以下の2つのキャッシュ戦略に焦点を当ててその挙動を視覚的に確認できます。

1.  **トップレベルキャッシュ (Full Route Cache)**
    ビルド時にページ全体が静的に生成され、キャッシュされる挙動を示します。主に頻繁に更新されないコンテンツに適しています。

2.  **関数キャッシュ (Data Cache)**
    `React.cache` を使用して、サーバーコンポーネント内で実行される非同期関数の結果を、単一のリクエストのライフサイクル内でキャッシュする挙動を示します。

また、これらのキャッシュ戦略についてまとめた解説ページも含まれています。

## セットアップ

1.  リポジトリをクローンします。
    ```bash
    git clone <リポジトリのURL>
    cd <プロジェクトディレクトリ>
    ```
2.  依存関係をインストールします。
    ```bash
    npm install
    ```

## 実行方法

### 開発モード

開発サーバーを起動します。コードの変更が即座に反映されます。

```bash
npm run dev
```

ブラウザで `http://localhost:3000` にアクセスしてください。

**注意:** 開発モードでは、パフォーマンス最適化のためのキャッシュが完全に適用されない場合があります。特に「トップレベルキャッシュ」の真の挙動を確認するには、本番モードでの実行が必要です。

### 本番モード

アプリケーションをビルドし、本番サーバーを起動します。これにより、Next.js のすべての最適化（キャッシュを含む）が適用されます。

1.  アプリケーションをビルドします。
    ```bash
    npm run build
    ```
2.  本番サーバーを起動します。
    ```bash
    npm run start
    ```

ブラウザで `http://localhost:3000` にアクセスしてください。

## デモの確認

トップページ (`/`) から以下のデモページにアクセスできます。

*   **トップレベルキャッシュ (Full Route Cache) のデモ:** (`/cache-demos/top-cache`)
    *   **本番モード (`npm run start`) で確認:** ページに表示される時刻が、リロードしても更新されないことを確認してください。これは、ビルド時に一度だけ生成されたHTMLがキャッシュされているためです。

*   **動的レンダリング + 関数キャッシュ (Data Cache) のデモ:** (`/cache-demos/func-cache`)
    *   **開発モード (`npm run dev`) または本番モード (`npm run start`) で確認:** ブラウザをリロードするとページに表示される時刻が更新されることを確認してください。しかし、サーバー側のコンソール（`npm run dev` や `npm run start` を実行しているターミナル）を見ると、`getServerTimeJST` のログが1回しか表示されないことを確認してください。これは、`React.cache` によって同一リクエスト内での関数呼び出しがキャッシュされているためです。

*   **キャッシュ戦略のまとめ:** (`/cache-demos/cache-summary`)
    *   トップレベルキャッシュと関数キャッシュの概要、使い分けのポイントについて解説しています。

## 技術スタック

*   Next.js
*   React
*   TypeScript

